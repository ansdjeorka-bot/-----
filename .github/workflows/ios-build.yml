name: iOS Build

# ìˆ˜ë™ íŠ¸ë¦¬ê±° ë˜ëŠ” push ì‹œ ì‹¤í–‰
on:
  workflow_dispatch:  # GitHubì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥
  push:
    branches: [ main, master ]

jobs:
  build-ios:
    runs-on: macos-latest  # macOSì—ì„œë§Œ iOS ë¹Œë“œ ê°€ëŠ¥
    
    steps:
    - name: Checkout ì½”ë“œ
      uses: actions/checkout@v4
      
    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20'  # ğŸ¯ 18ì—ì„œ 20ìœ¼ë¡œ ë³€ê²½!
        cache: 'npm'
        
    - name: í”„ë¡œì íŠ¸ ì •ë³´ í™•ì¸
      run: |
        echo "Node.js ë²„ì „:"
        node --version
        echo "npm ë²„ì „:"
        npm --version
        echo "í˜„ì¬ ë””ë ‰í† ë¦¬:"
        pwd
        echo "íŒŒì¼ ëª©ë¡:"
        ls -la
        
    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      run: npm install
      
    - name: ì›¹ ë¹Œë“œ
      run: npm run build
      
    - name: Capacitor ë²„ì „ í™•ì¸
      run: npx cap --version
      
    - name: Capacitor iOS í”Œë«í¼ ë™ê¸°í™”
      run: |
        if [ -d "ios" ]; then
          echo "iOS í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë™ê¸°í™”ë§Œ ì§„í–‰í•©ë‹ˆë‹¤."
          npx cap sync ios
        else
          echo "iOS í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ì¶”ê°€í•©ë‹ˆë‹¤."
          npx cap add ios
        fi
        
    - name: iOS í”„ë¡œì íŠ¸ ì •ë³´ í™•ì¸
      run: |
        if [ -d "ios" ]; then
          echo "iOS í´ë” ë‚´ìš©:"
          ls -la ios/
          if [ -d "ios/App" ]; then
            echo "iOS App í´ë” ë‚´ìš©:"
            ls -la ios/App/
          fi
        else
          echo "iOS í´ë”ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
        fi
        
    # ğŸš¨ ì—¬ê¸°ì„œë¶€í„°ëŠ” Apple Developer ê³„ì •ê³¼ ì¸ì¦ì„œê°€ í•„ìš”í•©ë‹ˆë‹¤!
    # ì•„ë˜ ë‹¨ê³„ë“¤ì€ Apple Developer ê³„ì • ì„¤ì • í›„ì— í™œì„±í™”í•˜ì„¸ìš”.
    
    # - name: Apple Developer ì¸ì¦ì„œ ì„¤ì¹˜
    #   run: |
    #     # Apple Developer ê³„ì •ì—ì„œ ë‹¤ìš´ë¡œë“œí•œ ì¸ì¦ì„œ ì„¤ì¹˜
    #     # ì—¬ê¸°ì— ì¸ì¦ì„œ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ ì˜ˆì •
    #     
    # - name: iOS ë¹Œë“œ (Archive)
    #   run: |
    #     cd ios/App
    #     xcodebuild -workspace App.xcworkspace \
    #                -scheme App \
    #                -configuration Release \
    #                -archivePath App.xcarchive \
    #                archive
    #                
    # - name: IPA ë‚´ë³´ë‚´ê¸°
    #   run: |
    #     cd ios/App
    #     xcodebuild -exportArchive \
    #                -archivePath App.xcarchive \
    #                -exportOptionsPlist ../../ExportOptions.plist \
    #                -exportPath ./
    #                
    # - name: IPA íŒŒì¼ ì—…ë¡œë“œ
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: iOS-App
    #     path: ios/App/*.ipa
