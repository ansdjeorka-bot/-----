name: iOS Build

# 수동 트리거 또는 push 시 실행
on:
  workflow_dispatch:  # GitHub에서 수동으로 실행 가능
  push:
    branches: [ main, master ]

jobs:
  build-ios:
    runs-on: macos-latest  # macOS에서만 iOS 빌드 가능
    
    steps:
    - name: Checkout 코드
      uses: actions/checkout@v4
      
    - name: Node.js 설정
      uses: actions/setup-node@v4
      with:
        node-version: '20'  # 🎯 18에서 20으로 변경!
        cache: 'npm'
        
    - name: 프로젝트 정보 확인
      run: |
        echo "Node.js 버전:"
        node --version
        echo "npm 버전:"
        npm --version
        echo "현재 디렉토리:"
        pwd
        echo "파일 목록:"
        ls -la
        
    - name: 의존성 설치
      run: npm install
      
    - name: 웹 빌드
      run: npm run build
      
    - name: Capacitor 버전 확인
      run: npx cap --version
      
    - name: Capacitor iOS 플랫폼 동기화
      run: |
        if [ -d "ios" ]; then
          echo "iOS 폴더가 이미 존재합니다. 동기화만 진행합니다."
          npx cap sync ios
        else
          echo "iOS 폴더가 없습니다. 새로 추가합니다."
          npx cap add ios
        fi
        
    - name: iOS 프로젝트 정보 확인
      run: |
        if [ -d "ios" ]; then
          echo "iOS 폴더 내용:"
          ls -la ios/
          if [ -d "ios/App" ]; then
            echo "iOS App 폴더 내용:"
            ls -la ios/App/
          fi
        else
          echo "iOS 폴더가 생성되지 않았습니다."
        fi
        
    # 🚨 여기서부터는 Apple Developer 계정과 인증서가 필요합니다!
    # 아래 단계들은 Apple Developer 계정 설정 후에 활성화하세요.
    
    # - name: Apple Developer 인증서 설치
    #   run: |
    #     # Apple Developer 계정에서 다운로드한 인증서 설치
    #     # 여기에 인증서 설치 스크립트 추가 예정
    #     
    # - name: iOS 빌드 (Archive)
    #   run: |
    #     cd ios/App
    #     xcodebuild -workspace App.xcworkspace \
    #                -scheme App \
    #                -configuration Release \
    #                -archivePath App.xcarchive \
    #                archive
    #                
    # - name: IPA 내보내기
    #   run: |
    #     cd ios/App
    #     xcodebuild -exportArchive \
    #                -archivePath App.xcarchive \
    #                -exportOptionsPlist ../../ExportOptions.plist \
    #                -exportPath ./
    #                
    # - name: IPA 파일 업로드
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: iOS-App
    #     path: ios/App/*.ipa
